FROM centos:7
ARG BLOCKCHAIN_DB_HOSTNAME

RUN yum install -y epel-release
RUN yum -y install make automake gcc gcc-c++ kernel-devel
RUN yum -y install python34
RUN yum -y install python-pip
RUN pip install --upgrade pip
RUN yum -y install postgresql-libs
RUN yum -y install postgresql-devel
RUN yum -y install python-devel
RUN pip install psycopg2
RUN echo $PATH

COPY ./setup.py .
COPY ./requirements.txt .
COPY ./blockchain/ blockchain/
RUN pip install -r requirements.txt

#Start processing
COPY ./configs/ configs/
COPY ./configs/blockchain.yml .
COPY ./pki/private-key.pem /blockchain/private-key.pem
COPY ./pki/public-key.pem blockchain/public-key.pem

RUN chmod a+x query_svc.py
#TODO Generate Keys
CMD ["python", "/blockchain/transaction_svc.py --private-key /blockchain/private-key.pem --public-key /blockchain/public-key.pem --port 80 --phase 1"]
ENTRYPOINT ["/bin/bash", "python ./blockchain/transaction_svc.py --private-key ./pki/private-key.pem --public-key ./pki/public-key.pem"]
